<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_list_picking3">
        <t t-set="car_no_def" t-value="docs.sorted(key=lambda m: int(m.car_number))[0]['car_number']"/>
        <t t-set="doc_temp" t-value="[]"/>
        <t t-foreach="docs.sorted(key=lambda m: int(m.car_number))" t-as="doc">
            <t t-if="doc.car_number == car_no_def">
                <t t-set="doc_temp" t-value="doc_temp+[doc]"/>
            </t>
            <t t-else="">
                <t t-set="car_no_def" t-value="doc.car_number"/>
                <t t-call="picking_list_report3.report_list_picking3_template"/>
                <t t-set="doc_temp" t-value="[]"/>
                <t t-set="doc_temp" t-value="doc_temp+[doc]"/>
            </t>
        </t>
        <t t-call="picking_list_report3.report_list_picking3_template"/>
    </template>
    <template id="report_list_picking3_template">
        <t t-call="web.html_container">
            <t t-call="web.external_layout">
                <div class="page" style="font-size:15px;">
                    <t t-if="len(doc_temp) > 0" t-set="category"
                       t-value="doc_temp[0]['category']"/>
                    <h2 align="center">
                        <span t-esc="category"/>
                        - 客戶明細"
                    </h2>
                    <div class="pull-right" style="margin-left:50%;">
                        <strong>日期:</strong>
<!--                        <span t-esc="context_timestamp(datetime.datetime.now()).strftime('%Y-%m-%d')"/>-->
                        <span t-esc="doc_temp[0]['sodate']"/>
                    </div>
                </div>
                <table class="table table-condensed" name="picking_list_table">
                    <tbody class="invoice_tbody">
                        <t t-set="car_num" t-value="-1"/>
                        <t t-set="customer_num" t-value="-1"/>
                        <t t-foreach="doc_temp" t-as="o">
                            <t t-foreach="o" t-as="c">
                                <t t-if="c.car_number != car_num">
                                    <tr>
                                        <td colspan="2"
                                            style="padding-left:10px; font-size: 22px;">
                                            <strong>車號:
                                                <span t-field="o.car_number"
                                                      style="font-size: 22px;"/>
                                            </strong>
                                        </td>
                                        <td/>
                                        <td/>
                                        <td/>
                                    </tr>
                                </t>
                                <t t-if="c.custno != customer_num">
                                    <tr>
                                        <th/>
                                        <th colspan="4"
                                            style="padding-left:10px;">
                                            <strong>
                                                <span t-field="c.custno"
                                                      style="font-size: 22px;"/>
                                                <span t-field="c.custname"
                                                      style="font-size: 22px;"/>
                                            </strong>
                                        </th>

                                    </tr>
                                    <t t-set="customer_num"
                                       t-value="c.custno"/>
                                </t>
                                <t t-set="car_num" t-value="c.car_number"/>
                                <tr>
                                    <td/>
                                    <td></td>
                                    <td>
                                        <span t-field="c.sono"
                                              style="font-size: 20px;"/>
                                    </td>
                                    <td colspan="2">
                                        <span t-field="c.productname"
                                              style="font-size: 20px;"/>
                                    </td>
                                    <td>
                                        <span t-field="c.product_qty"
                                              style="font-size: 20px;"/>
                                        <span t-field="c.unit"
                                              style="font-size: 20px;"/>
                                    </td>
                                </tr>
                            </t>
                        </t>
                    </tbody>
                </table>
            </t>
        </t>
    </template>
</odoo>

